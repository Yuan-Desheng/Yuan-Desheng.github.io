import{_ as s,o as a,c as i,R as n}from"./chunks/framework.lPQqlWxT.js";const e="/assets/Snipaste_2024-01-03_20-55-53._FH_SLNq.png",u=JSON.parse('{"title":"纯前端生成PDF","description":"","frontmatter":{},"headers":[],"relativePath":"Archer/纯前端生成PDF.md","filePath":"Archer/纯前端生成PDF.md"}'),p={name:"Archer/纯前端生成PDF.md"},t=n('<h1 id="纯前端生成pdf" tabindex="-1">纯前端生成PDF <a class="header-anchor" href="#纯前端生成pdf" aria-label="Permalink to &quot;纯前端生成PDF&quot;">​</a></h1><h2 id="参考文档" tabindex="-1">参考文档 <a class="header-anchor" href="#参考文档" aria-label="Permalink to &quot;参考文档&quot;">​</a></h2><p><a href="https://juejin.cn/post/7138370283739545613" target="_blank" rel="noreferrer">jsPDF + html2canvas A4分页截断 完美解决方案（含代码 + 案例）</a></p><p><a href="https://gitee.com/jseven68/vue-pdf2#%E5%8F%82%E8%80%83%E6%9D%A5%E6%BA%90" target="_blank" rel="noreferrer">纯前端导出 pdf</a></p><p><a href="https://juejin.cn/post/7161325300410744845" target="_blank" rel="noreferrer">使用jsPDF + html2canvas时遇到的所有问题汇总</a></p><p><a href="https://artskydj.github.io/jsPDF/docs/index.html" target="_blank" rel="noreferrer">jsPDF官方文档</a></p><p><a href="https://juejin.cn/post/7143596746856202254" target="_blank" rel="noreferrer">Puppeteer将动态html页面生成pdf（终极解决方案）</a></p><h2 id="处理思路" tabindex="-1">处理思路 <a class="header-anchor" href="#处理思路" aria-label="Permalink to &quot;处理思路&quot;">​</a></h2><p>通过深度搜索优先遍历，从顶部遍历需要转换的HTML节点， 并将节点分为三种情况进行处理</p><ol><li>普通节点。</li><li>需要进行分页处理并且内部可能包含也需要分页处理子节点的节点。</li><li>需要进行分页内部不包含需要分页处理的节点，即深度搜索的终点节点</li></ol><p>通过从高到低遍历维护一个分页数组pages，该数组记录每一页的起始位置，</p><p>如：pages[0] 对应 第一页起始位置， pages[1] 对应 第二页起始位置</p><p>图解如下： <img src="'+e+`" alt="An image"></p><p>通过深度遍历后得出每页起始位置的数组，</p><p>遍历数组，通过jspdf的addImage接口对canvas进行画面截取，</p><p>由于addImage只能固定位置的左上角起始点，</p><p>不能进行非常精确的上下定位截取（下一节会详解addImage)，</p><p>会造成截取多余的内容</p><p>（如上图页面 1中pages[1] 下方的内容会和 页面 2 中 pages[1] 下方的内容会一样（除长度外），</p><p>而页面 1中pages[1] 下方的内容是多余的（是属于页面 2的内容））</p><p>因此需要对页面不需要的内容 <code>使用jspdf的addBlank进行空白遮挡处理</code></p><h2 id="难点" tabindex="-1">难点 <a class="header-anchor" href="#难点" aria-label="Permalink to &quot;难点&quot;">​</a></h2><h3 id="内部滚动条导致滚动部分被截断问题" tabindex="-1">内部滚动条导致滚动部分被截断问题 <a class="header-anchor" href="#内部滚动条导致滚动部分被截断问题" aria-label="Permalink to &quot;内部滚动条导致滚动部分被截断问题&quot;">​</a></h3><p>当表格列数过多，表格内部产生滚动条，直接导出的话滚动条外是被截掉的，其实不管是表格还是其他组件，内部产生滚动条都是会被截掉的。</p><p>解决方案 1： 尽量不要产生内部滚动条，如果避免不了，那么可以考虑导出时候将样式更改，把宽度加大到不出现滚动条，同时可以考虑将页面方向换成横向，不然可能在 pdf 中字看起来过小。这个方案缺点是导出时候页面会看起来突然变宽了，不过可以加 loading 蒙版遮蔽一下。</p><p>解决方案 2： 如果不想导出时候更换样式，可以考虑渲染多一个，设置定位不可见，这个宽度就设置不出现滚动条为止，不过这样要多渲染，性能可能有点影响，内容多的话。</p><p>两个方案的目的都是导出时候不让内部产生滚动条</p><h3 id="导出内容过多-后面页面全是空白或者黑色" tabindex="-1">导出内容过多，后面页面全是空白或者黑色 <a class="header-anchor" href="#导出内容过多-后面页面全是空白或者黑色" aria-label="Permalink to &quot;导出内容过多，后面页面全是空白或者黑色&quot;">​</a></h3><p>这个是浏览器限制 canvas 最大绘制长度问题，不同浏览器有些不一样。</p><p>解决：可以分多个 cavans，用完 cavans 就销毁，最后合并。</p><h3 id="图片在-pdf-显示不出" tabindex="-1">图片在 pdf 显示不出 <a class="header-anchor" href="#图片在-pdf-显示不出" aria-label="Permalink to &quot;图片在 pdf 显示不出&quot;">​</a></h3><p>出现这个，那么就是画布被污染导致绘制失败，除了配置 html2canvas 设置可跨域加载图片外，同时要看这个图片链接本身是否开启了跨域访问，需要允许才可以。</p><p>当然，base64 的图片不会出现这种问题，如果图片小，可以先转成 basse64 解决。</p><p>VitePress provides Syntax Highlighting powered by <a href="https://github.com/antfu/shikiji" target="_blank" rel="noreferrer">Shikiji</a>, with additional features like line-highlighting:</p><p><strong>Input</strong></p><div class="language-md vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">md</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">\`\`\`js{4}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      msg: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Highlighted!&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">\`\`\`</span></span></code></pre></div><p><strong>Output</strong></p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line highlighted"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      msg: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Highlighted!&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="custom-containers" tabindex="-1">Custom Containers <a class="header-anchor" href="#custom-containers" aria-label="Permalink to &quot;Custom Containers&quot;">​</a></h2><p><strong>Input</strong></p><div class="language-md vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">md</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::: info</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">This is an info box.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:::</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::: tip</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">This is a tip.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:::</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::: warning</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">This is a warning.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:::</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::: danger</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">This is a dangerous warning.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:::</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::: details</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">This is a details block.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:::</span></span></code></pre></div><p><strong>Output</strong></p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>This is an info box.</p></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>This is a tip.</p></div><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>This is a warning.</p></div><div class="danger custom-block"><p class="custom-block-title">DANGER</p><p>This is a dangerous warning.</p></div><details class="details custom-block"><summary>Details</summary><p>This is a details block.</p></details><h2 id="more" tabindex="-1">More <a class="header-anchor" href="#more" aria-label="Permalink to &quot;More&quot;">​</a></h2><p>Check out the documentation for the <a href="https://vitepress.dev/guide/markdown" target="_blank" rel="noreferrer">full list of markdown extensions</a>.</p>`,49),l=[t];function h(r,d,k,o,c,E){return a(),i("div",null,l)}const m=s(p,[["render",h]]);export{u as __pageData,m as default};
